{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sidebar Design</title>

<style>
#file-explorer {
    list-style-type: none;
    padding-left: 0;
    font-size: 12px;
    margin-left: -15px
}
#file-explorer li {
    margin: 20px 8px ;
    padding-left : 5px;
    transition: background-color 0.2s ease;
    cursor: pointer;
    border-radius: 5px;
} 
.folderElementLi{
    flex-direction: column;
    align-items: flex-start !important;
}
.sidebar-folder-icon,
.sidebar-file-icon {
  font-size: 18px;
  margin-right: 8px; 
  display: inline-block; 
  align-items: center; 
}

.sidebar-folder-icon {
    color: #ffa726; 
}
.sidebar-file-icon {
    color: #5c6bc0; 
}
.sidebar-folder-name,
.file-text {
  font-size: 14px;
  color: black;
  display: inline-block; 
  align-items: center;
  word-wrap: break-word; 
  white-space: normal;  
  max-width: 200px; 
}

.folder-toggle {
    width: 20px;
    cursor: pointer;
    color: black;
    text-align: center;
    font-size: 14px;
    margin-right: 8px;
}

.folder-toggle.open {
    transform: rotate(90deg);
}

.subfolder {
    display: none; 
}

.subfolder li {
    white-space: nowrap;
    margin: 5px 0;
    display: flex;  
    align-items: center;
}
.subfolder .sidebar-folder-name,
.subfolder .file-text {
    margin-left: 5px;
}

</style>
</head>
<body>
    <div class="sidebar">
        <div class="d-flex align-items-center mb-2">
            <a href="/">
                <img src="{% static 'images/docs-logo.png' %}" alt="File Explorer" 
                     style="width: 100px; height: 100px; margin-right: 0px; margin-top: -20px; margin-left: -25px" />
            </a>
            <span class="sidebar-title">DOCS App</span>
        </div>
        
        <div class="file-browser">
            <h4>File Browser</h4>
            <ul id="file-explorer" data-current-path="root ">
            <!-- Folder and file structure will be populated dynamically -->
            </ul>
        </div>
    </div>

<script>
 document.addEventListener("DOMContentLoaded", () => {
    const fileExplorer = document.getElementById("file-explorer");

    function handleClick(event) {
        const target = event.target;

        if (target.classList.contains('folder-clickable') || target.classList.contains('file-clickable')) {
            document.querySelectorAll('.folder-clickable, .file-clickable').forEach((item) => {
                item.classList.remove('active');
            });
            target.classList.add('active');

            const path = target.getAttribute('data-path');
            const folderDisplay = document.getElementById('folder-name-display');
            if (folderDisplay) {
                folderDisplay.textContent = target.textContent;
            }
        }
    }

    fileExplorer.addEventListener('click', handleClick);

    function fetchAndRender(path, container, isSubFolder = false) {
        const baseUrl = window.location.origin + "/file-explorer";
        const url = `${baseUrl}?path=${encodeURIComponent(path)}`;

        if (container.dataset.loaded === "true") {
            return;
        }

        fetch(url, {
            headers: { "X-Requested-With": "XMLHttpRequest" },
        })
            .then((response) => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then((data) => {
                renderFileExplorer(data.folders, data.files, container, path, isSubFolder);
                container.dataset.loaded = "true"; 
            })
            .catch((error) => {
                console.error("Error fetching data:", error);
            });
    }

    function renderFileExplorer(folders, files, container, currentPath, isSubFolder) {
        if (!isSubFolder) {
            container.innerHTML = ""; 
        }
    
        folders.forEach((folder) => {
            const folderElement = document.createElement("li");
            folderElement.classList.add("folderElementLi");
            folderElement.classList.add("d-flex");
            folderElement.innerHTML = `
            <div>
                <span class="folder-toggle" data-path="${currentPath}/${folder.name}"> ▶ </span>
                <i class="sidebar-folder-icon fas fa-folder" style="font-size: 18px;"></i>
                <a href="/?path=${encodeURIComponent(folder.name)}" data-path="${currentPath}/${folder.name}" class="sidebar-folder-name folder-clickable" style="cursor:pointer">${folder.name}</a>
            </div>
                <ul class="subfolder" style="display: none; " data-loaded="false"></ul>
            `;
            container.appendChild(folderElement);
    
            const toggleButton = folderElement.querySelector(".folder-toggle");
            const subFolderContainer = folderElement.querySelector(".subfolder");
    
            toggleButton.addEventListener("click", function () {
                if (subFolderContainer.style.display === "none") {
                    subFolderContainer.style.display = "block";
                    this.textContent = "▼"; 
                    this.classList.add("open")
                    fetchAndRender(this.dataset.path.replace(/\/+/g, "/"), subFolderContainer, true);
                } else {
                    subFolderContainer.style.display = "none";
                    this.textContent = "▶";
                    this.classList.remove("open");
                }
            });
        });
    
        files.forEach((file) => {
            const fileElement = document.createElement("li");
        
            const parentFolder = currentPath.split('/').pop(); 
            fileElement.innerHTML = `
            <i class="sidebar-file-icon fas fa-file"></i>
            <a href="/?path=${encodeURIComponent(parentFolder)}" 
                data-path="${encodeURIComponent(parentFolder)}" 
                class="file-text file-clickable" 
                style="cursor:pointer">${file.name}</a>
             `;
            container.appendChild(fileElement);
        });
    }
    
    // Initialize with root path
    const initialPath = fileExplorer.getAttribute("data-current-path").trim() || "root";
    fetchAndRender(initialPath, fileExplorer);
});


</script>
    
</body>
</html>
